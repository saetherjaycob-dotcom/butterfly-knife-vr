<!-- Knife Root -->
<a-entity id="knife" position="0 1.45 -1" dual-handle-knife>

  <!-- Blade (fixed) -->
  <a-box
    id="blade"
    width="0.01"
    height="0.18"
    depth="0.02"
    color="#ccc"
    position="0 0.09 0">
  </a-box>

  <!-- Handle A (bite handle) -->
  <a-box
    class="handle"
    id="handleA"
    width="0.05"
    height="0.15"
    depth="0.03"
    color="#444"
    position="0 -0.075 0">
  </a-box>

  <!-- Handle B (safe handle) -->
  <a-box
    class="handle"
    id="handleB"
    width="0.05"
    height="0.15"
    depth="0.03"
    color="#666"
    position="0 -0.075 0">
  </a-box>

</a-entity>

<script>
AFRAME.registerComponent('dual-handle-knife', {
  init() {
    // Use el.querySelector so we find nested entities
    this.handleA = this.el.querySelector('#handleA')
    this.handleB = this.el.querySelector('#handleB')

    this.aAngle = 0
    this.bAngle = 0
    this.aVel = 0
    this.bVel = 0

    this.wristPower = 14
    this.gravity = 5
    this.damping = 0.985
    this.limit = Math.PI

    this.lastRot = this.el.object3D.rotation.x

    // Trigger snap open/close
    window.addEventListener('triggerdown', () => {
      const open = this.aAngle < Math.PI / 2
      this.aVel = open ? 6 : -6
      this.bVel = open ? -6 : 6
    })
  },

  tick(time, delta) {
    const dt = delta / 1000
    if (!dt) return

    const rot = this.el.object3D.rotation.x
    const dRot = rot - this.lastRot
    this.lastRot = rot

    // Apply momentum from wrist flick
    this.aVel += dRot * this.wristPower
    this.bVel -= dRot * this.wristPower

    // Gravity torque
    this.aVel -= Math.sin(this.aAngle) * this.gravity * dt
    this.bVel -= Math.sin(this.bAngle) * this.gravity * dt

    // Damping
    this.aVel *= this.damping
    this.bVel *= this.damping

    // Integrate
    this.aAngle += this.aVel
    this.bAngle += this.bVel

    // Clamp
    this.aAngle = Math.max(0, Math.min(this.limit, this.aAngle))
    this.bAngle = Math.max(0, Math.min(this.limit, this.bAngle))

    // Apply rotation
    this.handleA.object3D.rotation.x = this.aAngle
    this.handleB.object3D.rotation.x = -this.bAngle
  }
})
</script>
