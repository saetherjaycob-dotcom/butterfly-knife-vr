<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Butterfly Knife VR</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true" embedded background="color: #111">

      <!-- Camera + controllers -->
      <a-entity camera look-controls position="0 1.6 0"></a-entity>
      <a-entity id="rightHand" laser-controls="hand: right"></a-entity>

      <!-- Floor -->
      <a-plane rotation="-90 0 0" width="8" height="8" color="#222"></a-plane>

      <!-- Knife Root -->
      <a-entity id="knife" position="0 1.5 -1" knife-anim-control>

        <!-- Blade (fixed) -->
        <a-box id="blade" width="0.01" height="0.18" depth="0.02" color="#ccc" position="0 0.09 0"></a-box>

        <!-- Handle A -->
        <a-box id="handleA" width="0.05" height="0.15" depth="0.03" color="#444" position="0 -0.075 0"></a-box>

        <!-- Handle B -->
        <a-box id="handleB" width="0.05" height="0.15" depth="0.03" color="#666" position="0 -0.075 0"></a-box>

      </a-entity>

      <script>
        AFRAME.registerComponent('knife-anim-control', {
          init: function() {
            this.handleA = document.getElementById('handleA');
            this.handleB = document.getElementById('handleB');
            this.open = false;

            window.addEventListener('triggerdown', () => {
              this.open = !this.open;

              if (this.open) {
                this.handleA.setAttribute('animation__flip', {property: 'rotation', to: '180 0 0', dur: 300, easing: 'easeOutQuad', startEvents: 'go'});
                this.handleB.setAttribute('animation__flip', {property: 'rotation', to: '-180 0 0', dur: 300, easing: 'easeOutQuad', startEvents: 'go'});
              } else {
                this.handleA.setAttribute('animation__flip', {property: 'rotation', to: '0 0 0', dur: 300, easing: 'easeOutQuad', startEvents: 'go'});
                this.handleB.setAttribute('animation__flip', {property: 'rotation', to: '0 0 0', dur: 300, easing: 'easeOutQuad', startEvents: 'go'});
              }

              this.handleA.emit('go');
              this.handleB.emit('go');
            });
          }
        });
      </script>

    </a-scene>
  </body>
</html>
